Golang REST API Example
-
This is an example REST API built with Go using Gin and pgx.

The API implements:

Creating a user
Generating OTP for a user
Verifying OTP for a user

-----------------------------------

It uses:
Gin for routing
pgx for PostgreSQL database access
PostgreSQL for data storage

----------------------------------

I initially intended to also integrate sqlc for type-safe queries but faced issues setting it up on my Windows environment.

SQL Queries
The SQL queries for the main functions are defined in queries.sql:
-- Create user
INSERT INTO users (name, phone_number) VALUES ($1, $2) RETURNING *;

-- Generate OTP 
UPDATE users SET otp = $1, otp_expiration = $2 WHERE id = $3;

-- Verify OTP
SELECT * FROM users WHERE phone_number = $1 AND otp = $2 AND otp_expiration > NOW();

and the schema.sql:
CREATE TABLE users (
  id SERIAL PRIMARY KEY,
  name VARCHAR(50) NOT NULL,
  phone_number VARCHAR(15) UNIQUE NOT NULL, 
  otp VARCHAR(4),
  otp_expiration_time TIMESTAMPTZ
);

the sqlc.json file:
{
  "version": "2",
  "sql": [{
    "schema": "schema.sql",
    "queries": "query.sql",
    "engine": "postgresql",
    "gen": {
      "go": {
        "out": "db"
      }
    }
  }]
}

and the sqlc-version v1.23.0

the files generated by sqlc located in db folder containing db.go, models.go and query.sql.go


it should be consumed by sqlc to generate type-safe Go code.

-------------------------------------------

Usage
-
Prerequisites:
Golang
PostgreSQL

How to run:

Clone the repo
Create the PostgreSQL database and table
Update the DB connection config in main.go
Run the server:
go run main.go


The server will start on port 8080 by default.

The API exposes the following endpoints:

POST /api/users
POST /api/users/generateotp
POST /api/users/verifyotp
See main.go for endpoint details.
